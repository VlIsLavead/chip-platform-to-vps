{% extends "base.html" %}

{% load custom_filters %}

{% block content %}

<div class="chat-container">
    <div id="messages-container">
        {% for message in messages %}
            <div class="message" id="message-{{ message.id }}">
                <p><strong>{{ message.user.role.name }}-{{ message.user }}</strong> ({{ message.created_at }}): <br>{{ message.text }}</p>
                {% for file in message.files.all %}
                    <a href="{{ file.file.url }}" download class="file-download-btn">{{ file.file.name|filename }}</a>
                {% endfor %}
            </div>
        {% endfor %}
    </div>
    <form method="post" enctype="multipart/form-data" class="message-form" id="message-form">
        {% csrf_token %}
        
        <textarea name="text" class="message-input" id="message-input" placeholder="Введите ваше сообщение..."></textarea>

        <div class="file-upload-container">
            <input type="file" name="file" multiple class="file-input" />
            <button type="submit" class="chat-button submit-btn">Отправить</button>
        </div>
    </form>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        var messagesContainer = document.getElementById("messages-container");
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
        
        // Добавляем обработчик нажатия клавиш в текстовое поле
        var messageInput = document.getElementById("message-input");
        var messageForm = document.getElementById("message-form");
        
        messageInput.addEventListener("keydown", function(e) {
            // Проверяем, что нажата клавиша Enter без Shift
            if (e.key === "Enter" && !e.shiftKey) {
                e.preventDefault(); // Предотвращаем перенос строки
                messageForm.submit(); // Отправляем форму
            }
        });
    });
</script>

{% endblock %}