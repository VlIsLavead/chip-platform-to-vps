{% extends "base.html" %}
{% load custom_filters %}

{% block content %}
<div class="users-container">
    <div class="user-block">
        <div class="user-title">
            Документы компании: {{ company_name }}<br>
            </a>
        </div>
        <a href="{% url 'all_documents' %}">
            ← Вернуться ко всем компаниям
        </a>
    </div>
    
    {% for profile, documents in user_documents.items %}
    <div class="user-block">
        <div class="user-title">
            {{ profile.user.username }}
        </div>

        <!-- Таблицы документов (такие же как в all_documents.html) -->
        <div class="table-container first-row">
            <table border="1" class="file-table">
                <tr><th>Запрос на доступ потребителя</th></tr>
                {% for document in documents.consumer_request_documents %}
                <tr>
                    <td>
                        {% if document.file_path %}
                            <a href="{{ document.file_path.url }}" download>{{ document.file_path.name|filename }}</a>
                        {% else %}
                            <span>Нет файла</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr><td><span>Нет файлов</span></td></tr>
                {% endfor %}
            </table>

            <table border="1" class="file-table">
                <tr><th>Анкета потребителя</th></tr>
                {% for document in documents.consumer_form_documents %}
                <tr>
                    <td>
                        {% if document.file_path %}
                            <a href="{{ document.file_path.url }}" download>{{ document.file_path.name|filename }}</a>
                        {% else %}
                            <span>Нет файла</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr><td><span>Нет файлов</span></td></tr>
                {% endfor %}
            </table>
        </div>

        <div class="table-container second-row">
            <table border="1" class="file-table wide-table">
                <tr>
                    <th>Номер заказа</th>
                    <th>Файл договора</th>
                    <th>Файл счета</th>
                </tr>
                {% for order in documents.contract_documents %}
                <tr>
                    <td>{{ order.order_number }}</td>
                    <td>
                        {% if order.contract_file %}
                            <a href="{{ order.contract_file.url }}" download>{{ order.contract_file.name|filename }}</a>
                        {% else %}
                            <span>Нет файла</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if order.invoice_file %}
                            <a href="{{ order.invoice_file.url }}" download>{{ order.invoice_file.name|filename }}</a>
                        {% else %}
                            <span>Нет файла</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3"><span>Нет заказов</span></td>
                </tr>
                {% endfor %}
            </table>
        </div>
    </div>
    {% empty %}
    <div class="alert alert-warning">
        Нет документов для этой компании
    </div>
    {% endfor %}
</div>
{% endblock content %}