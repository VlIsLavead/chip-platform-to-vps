{% extends "base.html" %}

{% block sub_tabs %}
<div id="header">
    <ul class="menu">
        <li {% if sub_section == "general" %}class="selected"{% endif %}>
            <a href="{% url 'feedback' %}?tab=general">Общие вопросы</a>
        </li>
        <li {% if sub_section == "support" %}class="selected"{% endif %}>
            <a href="{% url 'feedback' %}?tab=support">Вопросы по заказам</a>
        </li>
    </ul>
</div>
{% endblock %}

{% block content %}
<h1>Обратная связь</h1>

{% if sub_section == "general" %}
    <h2>Общие вопросы</h2>
    <table border="1" class="no-center" style="width: 50%;  border-collapse: inherit; text-align: left;">
        <thead>
            <tr>
                <th>Тема</th>
                <th>Время последнего сообщения</th>
            </tr>
        </thead>
        <tbody>
            {% for topic in general_topics %}
                <tr>
                    <td class="d-flex">
                        <a href="{% url 'topic_detail' topic.id %}">{{ topic.name }}</a> 
                        <p class="center {% if topic.unread_count > 0 %}unread{% endif %}">{{ topic.unread_count }}</p>
                    </td>
                    <td>
                        {% if topic.last_message_time %}
                            {{ topic.last_message_time|date:"d-m-Y H:i" }}
                        {% else %}
                            Нет сообщений
                        {% endif %}
                    </td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="2">Нет общих тем</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    <br>
    <form method="post" action="{% url 'create_general_topic' %}" style="margin-bottom: 20px;">
        {% csrf_token %}
        <input type="text" name="topic_name" class="input_text" placeholder="Введите название темы">
        <button type="submit" class="button">Создать новую тему</button>
    </form>
{% elif sub_section == "support" %}
    <h2>Вопросы по заказам</h2>
    <table border="1" class="no-center" style="width: 50%; border-collapse: inherit; text-align: left;">
        <thead>
            <tr>
                <th>Тема</th>
                <th>Время последнего сообщения</th>
            </tr>
        </thead>
        <tbody>
            {% for topic in private_topics %}
                <tr>
                    <td class="d-flex">
                        <a href="{% url 'topic_detail' topic.id %}">{{ topic.name }}</a> 
                        <p class="center {% if topic.unread_count > 0 %}unread{% endif %}">{{ topic.unread_count }}</p>
                    </td>
                    <td>
                        {% if topic.last_message_time %}
                            {{ topic.last_message_time|date:"d-m-Y H:i" }}
                        {% else %}
                            Нет сообщений
                        {% endif %}
                    </td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="2">Нет доступных частных чатов</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endif %}
{% endblock %}
